/*==============================================================================
   LoopSystem ESP32
  ============================================================================*/

//==============================================================================
//  Includes
//==============================================================================
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"
#include "esp_freertos_hooks.h"

#include "system.h"
#include "SPIFFS.h"
#include "config.h"
#include "runtime_config.h"
#include "webserver.h"

#include "logger.h"

//==============================================================================
//  Defines
//==============================================================================
#define CMP_NAME        "System"

//==============================================================================
//  Local types
//==============================================================================


//==============================================================================
//  Local function definitions
//==============================================================================

//==============================================================================
//  Local data
//==============================================================================

//==============================================================================
//  Local functions
//==============================================================================


//==============================================================================
//  Exported functions
//==============================================================================
void SystemRestart()
{
    Log(eLogWarn, CMP_NAME, "SystemRestart called!");
    WebserverCloseSockets();
    ConfigFinalize();
    SPIFFS.end();
    vTaskDelay(500 / portTICK_PERIOD_MS);
    ESP.restart();
}

void SystemGetMemoryInfo(String & memInfo)
{
    memInfo = String("Free: ");
    memInfo += String(esp_get_free_heap_size()/1024);
    memInfo += String("kB, Min Free: ");
    memInfo += String(esp_get_minimum_free_heap_size()/1024);
    memInfo += String("kB");
}
